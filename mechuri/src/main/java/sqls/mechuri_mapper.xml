<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hk.mechuri">





<select id='productlist' resultType='productDto' parameterType="Map">
SELECT PRODUCT_NO,PRODUCT_NAME,PRODUCT_BRAND,PRODUCT_ML,PRODUCT_PRICE,
(SELECT AVG(REVIEW_POINT) FROM REVIEW WHERE REVIEW.REVIEW_PRODUCTNO=PRODUCT.PRODUCT_NO) AS PRODUCT_POINT,
(SELECT COUNT(*) FROM REVIEW WHERE REVIEW.REVIEW_PRODUCTNO=PRODUCT.PRODUCT_NO) AS PRODUCT_POINTCOUNT FROM PRODUCT
ORDER BY (SELECT AVG(REVIEW_POINT) FROM REVIEW WHERE REVIEW.REVIEW_PRODUCTNO=PRODUCT.PRODUCT_NO) DESC NULLS LAST
</select>

<!-- 커뮤니티 리스트 출력 쿼리 -->
<select id='boardlist2' resultType='boardDto' parameterType='Map'>
	SELECT BOARD_NO,BOARD_TITLE,BOARD_NICK,BOARD_REGDATE,BOARD_COUNT FROM BOARD 
	<if test="seq != null"> <!-- if문 같은 다이나믹쿼리를 쓸 때는 파라미터타입을 꼭 Map으로 해야함 그래야 seq가 인식가능 -->
			<where>
			 	<include refid="param" />
			</where>
		</if>
		ORDER BY BOARD_NO
	</select>
	<sql id="param">
		SEQ=#{seq}
	</sql>

	
<insert id="insertBoard" parameterType='boardDto'>
	<!-- INSERT INTO BOARD(BOARD_SEQ.NEXTVAL,BOARD_NICK,BOARD_TITLE,BOARD_CONTS,BOARD_REGDATE,BOARD_COUNT,BOARD_FILENO,
	BOARD_ORIGINFILE,BOARD_STOREDFILE,BOARD_FILEREGDATE,BOARD_FILESIZE) -->
	INSERT INTO BOARD VALUES(BOARD_SEQ.NEXTVAL,#{board_title},#{board_conts},BOARD_ORIGINFILE) 
</insert>









</mapper>